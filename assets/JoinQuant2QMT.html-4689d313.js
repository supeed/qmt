import{_ as s,o as n,c as a,a as l}from"./app-4f7ad5aa.js";const p={},o=l(`<h1 id="聚宽用户引导文档" tabindex="-1"><a class="header-anchor" href="#聚宽用户引导文档" aria-hidden="true">#</a> 聚宽用户引导文档</h1><h2 id="_1-结构对比" tabindex="-1"><a class="header-anchor" href="#_1-结构对比" aria-hidden="true">#</a> 1. 结构对比</h2><h3 id="聚宽代码结构" tabindex="-1"><a class="header-anchor" href="#聚宽代码结构" aria-hidden="true">#</a> 聚宽代码结构</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dracula" style="background-color:#282A36;" tabindex="0"><code><span class="line"><span style="color:#FF79C6;">def</span><span style="color:#F8F8F2;"> </span><span style="color:#50FA7B;">initialize</span><span style="color:#F8F8F2;">(</span><span style="color:#FFB86C;font-style:italic;">context</span><span style="color:#F8F8F2;">):</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 定义一个全局变量, 保存要操作的股票，如000001平安银行</span></span>
<span class="line"><span style="color:#F8F8F2;">    g.security </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">000001.XSHE</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 运行函数</span></span>
<span class="line"><span style="color:#F8F8F2;">    run_daily(market_open, </span><span style="color:#FFB86C;font-style:italic;">time</span><span style="color:#FF79C6;">=</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">every_bar</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#6272A4;"># 每个单位时间(如果按天回测,则每天调用一次,如果按分钟,则每分钟调用一次)调用一次</span></span>
<span class="line"><span style="color:#FF79C6;">def</span><span style="color:#F8F8F2;"> </span><span style="color:#50FA7B;">market_open</span><span style="color:#F8F8F2;">(</span><span style="color:#FFB86C;font-style:italic;">context</span><span style="color:#F8F8F2;">):</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> g.security </span><span style="color:#FF79C6;">not</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">in</span><span style="color:#F8F8F2;"> context.portfolio.positions:</span></span>
<span class="line"><span style="color:#F8F8F2;">        order(g.security, </span><span style="color:#BD93F9;">1000</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FF79C6;">else</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">        order(g.security, </span><span style="color:#FF79C6;">-</span><span style="color:#BD93F9;">800</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="qmt代码结构" tabindex="-1"><a class="header-anchor" href="#qmt代码结构" aria-hidden="true">#</a> QMT代码结构</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dracula" style="background-color:#282A36;" tabindex="0"><code><span class="line"><span style="color:#6272A4;">#示例说明：本策略，在回测的每个周期买入主图标的</span></span>
<span class="line"><span style="color:#FF79C6;">def</span><span style="color:#F8F8F2;"> </span><span style="color:#50FA7B;">init</span><span style="color:#F8F8F2;">(</span><span style="color:#FFB86C;font-style:italic;">C</span><span style="color:#F8F8F2;">):</span></span>
<span class="line"><span style="color:#F8F8F2;">	</span><span style="color:#6272A4;">#init handlebar函数的入参是ContextInfo对象 可以缩写为C</span></span>
<span class="line"><span style="color:#F8F8F2;">	</span><span style="color:#6272A4;">#设置测试标的为主图品种</span></span>
<span class="line"><span style="color:#F8F8F2;">	C.stock</span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> C.stockcode </span><span style="color:#FF79C6;">+</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">.</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">+</span><span style="color:#F8F8F2;">C.market</span></span>
<span class="line"><span style="color:#F8F8F2;">	</span><span style="color:#6272A4;">#accountid为测试的ID 回测模式资金账号可以填任意字符串</span></span>
<span class="line"><span style="color:#F8F8F2;">	C.accountid </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">testS</span><span style="color:#E9F284;">&quot;</span></span>
<span class="line"><span style="color:#FF79C6;">def</span><span style="color:#F8F8F2;"> </span><span style="color:#50FA7B;">handlebar</span><span style="color:#F8F8F2;">(</span><span style="color:#FFB86C;font-style:italic;">C</span><span style="color:#F8F8F2;">):</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># handlebar在回测时，会在回测周期的每根bar被执行一次</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># handlebar在实时行情下，会随着主图tick的更新被调用</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># passorder是QMT的综合下单函数，具体参数字段参考官方文档</span></span>
<span class="line"><span style="color:#F8F8F2;">    passorder(</span><span style="color:#BD93F9;">23</span><span style="color:#F8F8F2;">, </span><span style="color:#BD93F9;">1101</span><span style="color:#F8F8F2;">,C.accountid, C.stock, </span><span style="color:#BD93F9;">5</span><span style="color:#F8F8F2;">, </span><span style="color:#FF79C6;">-</span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">, C)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>QMT中，所有数据都存储在本地，所有的策略计算都在电脑本地运行，您可以自由使用下载到的数据与python库</p><h2 id="_2-聚宽代码移植qmt示例" tabindex="-1"><a class="header-anchor" href="#_2-聚宽代码移植qmt示例" aria-hidden="true">#</a> 2.聚宽代码移植QMT示例</h2><h3 id="聚宽代码" tabindex="-1"><a class="header-anchor" href="#聚宽代码" aria-hidden="true">#</a> 聚宽代码</h3><blockquote><p>当价格高于5日均线平均价格1.05时买入，当价格低于5日平均价格0.95时卖出。</p></blockquote><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dracula" style="background-color:#282A36;" tabindex="0"><code><span class="line"><span style="color:#6272A4;"># 导入函数库</span></span>
<span class="line"><span style="color:#FF79C6;">import</span><span style="color:#F8F8F2;"> jqdata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;"># 初始化函数，设定要操作的股票、基准等等</span></span>
<span class="line"><span style="color:#FF79C6;">def</span><span style="color:#F8F8F2;"> </span><span style="color:#50FA7B;">initialize</span><span style="color:#F8F8F2;">(</span><span style="color:#FFB86C;font-style:italic;">context</span><span style="color:#F8F8F2;">):</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 定义一个全局变量, 保存要操作的股票</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 000001(股票:平安银行)</span></span>
<span class="line"><span style="color:#F8F8F2;">    g.security </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">000001.XSHE</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 设定沪深300作为基准</span></span>
<span class="line"><span style="color:#F8F8F2;">    set_benchmark(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">000300.XSHG</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 开启动态复权模式(真实价格)</span></span>
<span class="line"><span style="color:#F8F8F2;">    set_option(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">use_real_price</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, </span><span style="color:#BD93F9;">True</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;"># 每个单位时间(如果按天回测,则每天调用一次,如果按分钟,则每分钟调用一次)调用一次</span></span>
<span class="line"><span style="color:#FF79C6;">def</span><span style="color:#F8F8F2;"> </span><span style="color:#50FA7B;">handle_data</span><span style="color:#F8F8F2;">(</span><span style="color:#FFB86C;font-style:italic;">context</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">):</span></span>
<span class="line"><span style="color:#F8F8F2;">    security </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> g.security</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 获取股票的收盘价</span></span>
<span class="line"><span style="color:#F8F8F2;">    close_data </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> attribute_history(security, </span><span style="color:#BD93F9;">5</span><span style="color:#F8F8F2;">, </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">1d</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, [</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">close</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">])</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 取得过去五天的平均价格</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#BD93F9;">MA5</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> close_data[</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">close</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">].mean()</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 取得上一时间点价格</span></span>
<span class="line"><span style="color:#F8F8F2;">    current_price </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> close_data[</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">close</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">][</span><span style="color:#FF79C6;">-</span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">]</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 取得当前的现金</span></span>
<span class="line"><span style="color:#F8F8F2;">    cash </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> context.portfolio.cash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 如果上一时间点价格高出五天平均价5%, 则全仓买入</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> current_price </span><span style="color:#FF79C6;">&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">1.05</span><span style="color:#FF79C6;">*</span><span style="color:#BD93F9;">MA5</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#6272A4;"># 用所有 cash 买入股票</span></span>
<span class="line"><span style="color:#F8F8F2;">        order_value(security, cash)</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#6272A4;"># 记录这次买入</span></span>
<span class="line"><span style="color:#F8F8F2;">        log.info(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">Buying </span><span style="color:#BD93F9;">%s</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">%</span><span style="color:#F8F8F2;"> (security))</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 如果上一时间点价格低于五天平均价, 则空仓卖出</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FF79C6;">elif</span><span style="color:#F8F8F2;"> current_price </span><span style="color:#FF79C6;">&lt;</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">0.95</span><span style="color:#FF79C6;">*</span><span style="color:#BD93F9;">MA5</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">and</span><span style="color:#F8F8F2;"> context.portfolio.positions[security].closeable_amount </span><span style="color:#FF79C6;">&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">0</span><span style="color:#F8F8F2;">:</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#6272A4;"># 卖出所有股票,使这只股票的最终持有量为0</span></span>
<span class="line"><span style="color:#F8F8F2;">        order_target(security, </span><span style="color:#BD93F9;">0</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#6272A4;"># 记录这次卖出</span></span>
<span class="line"><span style="color:#F8F8F2;">        log.info(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">Selling </span><span style="color:#BD93F9;">%s</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">%</span><span style="color:#F8F8F2;"> (security))</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 画出上一时间点价格</span></span>
<span class="line"><span style="color:#F8F8F2;">    record(</span><span style="color:#FFB86C;font-style:italic;">stock_price</span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;">current_price)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="qmt代码" tabindex="-1"><a class="header-anchor" href="#qmt代码" aria-hidden="true">#</a> QMT代码</h3><blockquote><p>单股示例，当价格高于5日均线平均价格1.05时买入，当价格低于5日平均价格0.95时卖出。</p></blockquote><div class="language-python line-numbers-mode" data-ext="py"><pre class="shiki dracula" style="background-color:#282A36;" tabindex="0"><code><span class="line"><span style="color:#6272A4;"># QMT是一个本地端界面化软件，回测基准，回测手续费，回测起止时间都可在界面右侧栏进行设置</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;"># 初始化函数，设定要操作的股票，参数等</span></span>
<span class="line"><span style="color:#FF79C6;">def</span><span style="color:#F8F8F2;"> </span><span style="color:#50FA7B;">init</span><span style="color:#F8F8F2;">(</span><span style="color:#FFB86C;font-style:italic;">C</span><span style="color:#F8F8F2;">):</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 定义一个全局变量，设定要操作的股票</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># C.stock_list = C.get_stock_list_in_sector(&quot;沪深300&quot;)  # 获取沪深300股票列表</span></span>
<span class="line"><span style="color:#F8F8F2;">    C.stock_list </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> [</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">000001.SZ</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">] </span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 设定回测初始资金</span></span>
<span class="line"><span style="color:#F8F8F2;">    C.capital </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">1000000</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 设定回测账号，实盘中账号在交易设置截面选择</span></span>
<span class="line"><span style="color:#F8F8F2;">    C.account_id </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">testaccID</span><span style="color:#E9F284;">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># # 关于回测时间，既可以在编辑器右侧栏设置，也可通过代码设置</span></span>
<span class="line"><span style="color:#F8F8F2;">    C.start </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">2017-06-06 00:00:00</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"><span style="color:#F8F8F2;">    C.end </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">2020-06-06 10:00:00</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">def</span><span style="color:#F8F8F2;"> </span><span style="color:#50FA7B;">handlebar</span><span style="color:#F8F8F2;">(</span><span style="color:#FFB86C;font-style:italic;">C</span><span style="color:#F8F8F2;">):</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;">#当前k线日期</span></span>
<span class="line"><span style="color:#F8F8F2;">    bar_date </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> timetag_to_datetime(C.get_bar_timetag(C.barpos), </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">%Y%m</span><span style="color:#BD93F9;">%d</span><span style="color:#F1FA8C;">%H%M%S</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 获取市场行情，具体参数释义见文档</span></span>
<span class="line"><span style="color:#F8F8F2;">    market_data </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> C.get_market_data_ex([</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">open</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">, </span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">high</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">, </span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">low</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">, </span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">close</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">],C.stock_list,</span><span style="color:#FFB86C;font-style:italic;">period</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">1d</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">,</span><span style="color:#FFB86C;font-style:italic;">end_time</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> bar_date)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 获取当前账户资金</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FF79C6;">for</span><span style="color:#F8F8F2;"> i </span><span style="color:#FF79C6;">in</span><span style="color:#F8F8F2;"> get_trade_detail_data(C.account_id,</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">stock</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">,</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">account</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">):</span></span>
<span class="line"><span style="color:#F8F8F2;">        cash </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> i.m_dAvailable</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 获取当前持仓信息，本示例中的holding_dict结构是{stock_code:lots}</span></span>
<span class="line"><span style="color:#F8F8F2;">    holding_dict </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> {obj.m_strInstrumentID</span><span style="color:#FF79C6;">+</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">.</span><span style="color:#E9F284;">&quot;</span><span style="color:#FF79C6;">+</span><span style="color:#F8F8F2;">obj.m_strExchangeID : obj.m_nVolume </span><span style="color:#FF79C6;">for</span><span style="color:#F8F8F2;"> obj </span><span style="color:#FF79C6;">in</span><span style="color:#F8F8F2;"> get_trade_detail_data(C.account_id,</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">stock</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">,</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">position</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">)}</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;"># 遍历gmd返回的字典数据</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FF79C6;">for</span><span style="color:#F8F8F2;"> i </span><span style="color:#FF79C6;">in</span><span style="color:#F8F8F2;"> market_data:</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#6272A4;"># 获取K线数据</span></span>
<span class="line"><span style="color:#F8F8F2;">        kline </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> market_data[i]</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#6272A4;"># 获取收盘价序列</span></span>
<span class="line"><span style="color:#F8F8F2;">        close_data </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> kline[</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">close</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">]</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#6272A4;"># 计算MA5</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#BD93F9;">MA5</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> close_data.rolling(</span><span style="color:#BD93F9;">5</span><span style="color:#F8F8F2;">).mean()</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#6272A4;"># 如果上一时间点价格高出五天平均价5%, 且当前无持仓, 则全仓买入</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> close_data.iloc[</span><span style="color:#FF79C6;">-</span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">] </span><span style="color:#FF79C6;">&gt;</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">1.05</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">*</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">MA5</span><span style="color:#F8F8F2;">.iloc[</span><span style="color:#FF79C6;">-</span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">] </span><span style="color:#FF79C6;">and</span><span style="color:#F8F8F2;"> i </span><span style="color:#FF79C6;">not</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">in</span><span style="color:#F8F8F2;"> holding_dict.keys():</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#6272A4;"># 全仓买入，交易记录会被客户端自动记录在回测结果，此处展示按金额交易的方法</span></span>
<span class="line"><span style="color:#F8F8F2;">            passorder(</span><span style="color:#BD93F9;">23</span><span style="color:#F8F8F2;">, </span><span style="color:#BD93F9;">1123</span><span style="color:#F8F8F2;">, C.account_id, i, </span><span style="color:#BD93F9;">5</span><span style="color:#F8F8F2;">, </span><span style="color:#FF79C6;">-</span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">, C)</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#8BE9FD;">print</span><span style="color:#F8F8F2;">(</span><span style="color:#FF79C6;">f</span><span style="color:#F1FA8C;">&quot;</span><span style="color:#BD93F9;">{</span><span style="color:#F8F8F2;">bar_date</span><span style="color:#BD93F9;">}</span><span style="color:#F1FA8C;">——</span><span style="color:#BD93F9;">{</span><span style="color:#F8F8F2;">i</span><span style="color:#BD93F9;">}</span><span style="color:#F1FA8C;">触发买入&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#FF79C6;">elif</span><span style="color:#F8F8F2;"> close_data.iloc[</span><span style="color:#FF79C6;">-</span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">] </span><span style="color:#FF79C6;">&lt;</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">0.95</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">*</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">MA5</span><span style="color:#F8F8F2;">.iloc[</span><span style="color:#FF79C6;">-</span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">] </span><span style="color:#FF79C6;">and</span><span style="color:#F8F8F2;"> i </span><span style="color:#FF79C6;">in</span><span style="color:#F8F8F2;"> holding_dict.keys():</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#6272A4;"># 获取当前持仓数量</span></span>
<span class="line"><span style="color:#F8F8F2;">            lots </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> holding_dict[i]</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#6272A4;"># 全仓卖出，交易记录会被客户端自动记录在回测结果，此处展示按股数交易的方法</span></span>
<span class="line"><span style="color:#F8F8F2;">            passorder(</span><span style="color:#BD93F9;">24</span><span style="color:#F8F8F2;">, </span><span style="color:#BD93F9;">1101</span><span style="color:#F8F8F2;">, C.account_id, i, </span><span style="color:#BD93F9;">5</span><span style="color:#F8F8F2;">, </span><span style="color:#FF79C6;">-</span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">, lots, C)</span></span>
<span class="line"><span style="color:#F8F8F2;">            </span><span style="color:#8BE9FD;">print</span><span style="color:#F8F8F2;">(</span><span style="color:#FF79C6;">f</span><span style="color:#F1FA8C;">&quot;</span><span style="color:#BD93F9;">{</span><span style="color:#F8F8F2;">bar_date</span><span style="color:#BD93F9;">}</span><span style="color:#F1FA8C;">——</span><span style="color:#BD93F9;">{</span><span style="color:#F8F8F2;">i</span><span style="color:#BD93F9;">}</span><span style="color:#F1FA8C;">触发卖出&quot;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-qmt特色函数" tabindex="-1"><a class="header-anchor" href="#_3-qmt特色函数" aria-hidden="true">#</a> 3. QMT特色函数</h2><h3 id="获取数据" tabindex="-1"><a class="header-anchor" href="#获取数据" aria-hidden="true">#</a> 获取数据</h3><p>get_weight_in_index 获取某只股票在某指数中的绝对权重</p><p>get_divid_factors 获取除权除息日和复权因子</p><p>get_top10_share_holder 获取十大股东数据</p><p>get_etf_info 根据ETF基金代码获取ETF申赎清单及对应成分股数据</p><p>get_etf_iopv 根据ETF基金代码获取ETF的基金份额参考净值</p><p>subscribe_whole_quote 订阅市场全推(tick)</p><p>subscribe_quote 订阅单股行情数据</p><p>get_option_list 获取指定日期期权列表</p>`,24),e=[o];function F(c,t){return n(),a("div",null,e)}const i=s(p,[["render",F],["__file","JoinQuant2QMT.html.vue"]]);export{i as default};
